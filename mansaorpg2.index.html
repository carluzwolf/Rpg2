<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MANSÃƒO â€” A HistÃ³ria</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400;1,700&family=EB+Garamond:ital,wght@0,400;0,500;1,400;1,500&family=Bebas+Neue&display=swap');

:root {
  --bg: #07050a;
  --bg2: #0f0b14;
  --bg3: #16111e;
  --gold: #c8952a;
  --gold2: #e5b84a;
  --rose: #b84060;
  --rose2: #e06080;
  --lilac: #9060c0;
  --teal: #208080;
  --cream: #ede0cc;
  --muted: #7a6880;
  --border: rgba(200,149,42,0.18);
}

* { margin:0; padding:0; box-sizing:border-box; }

body {
  background: var(--bg);
  color: var(--cream);
  font-family: 'EB Garamond', serif;
  font-size: 18px;
  line-height: 1.85;
  min-height: 100vh;
  cursor: default;
}

body::before {
  content:'';
  position:fixed;
  inset:0;
  background:
    radial-gradient(ellipse at 15% 40%, rgba(184,64,96,0.06) 0%, transparent 55%),
    radial-gradient(ellipse at 85% 25%, rgba(200,149,42,0.07) 0%, transparent 50%),
    radial-gradient(ellipse at 50% 90%, rgba(144,96,192,0.05) 0%, transparent 50%);
  pointer-events:none;
  z-index:0;
}

#app { position:relative; z-index:1; }

/* â•â•â• TITLE SCREEN â•â•â• */
#title-screen {
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  min-height:100vh;
  text-align:center;
  padding:40px 24px;
  gap:0;
  animation: fadeIn 1.5s ease both;
}

@keyframes fadeIn { from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:none} }

.eyebrow {
  font-family:'Bebas Neue',sans-serif;
  font-size:11px;
  letter-spacing:9px;
  color:var(--gold);
  opacity:.6;
  margin-bottom:18px;
}

.big-title {
  font-family:'Playfair Display',serif;
  font-size:clamp(72px,17vw,140px);
  font-weight:900;
  font-style:italic;
  line-height:.85;
  background:linear-gradient(145deg, var(--gold2) 0%, var(--gold) 35%, var(--rose) 80%);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
  filter:drop-shadow(0 0 50px rgba(200,149,42,.25));
  margin-bottom:6px;
}

.sub {
  font-family:'EB Garamond',serif;
  font-style:italic;
  font-size:20px;
  color:var(--muted);
  letter-spacing:3px;
  margin-bottom:50px;
}

.orn { width:180px; height:1px; background:linear-gradient(to right,transparent,var(--gold),transparent); margin:28px auto; }

.warning-box {
  max-width:500px;
  border:1px solid rgba(184,64,96,.3);
  padding:14px 24px;
  font-size:14px;
  color:var(--rose2);
  letter-spacing:.5px;
  margin-bottom:40px;
  background:rgba(184,64,96,.04);
}

.cast-wrap {
  display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin-bottom:50px; max-width:600px;
}

.cast-pill {
  padding:5px 15px;
  border-radius:100px;
  border:1px solid var(--border);
  font-size:14px;
  color:var(--muted);
  background:rgba(255,255,255,.02);
  font-style:italic;
}
.cast-pill.couple {
  border-color:rgba(184,64,96,.4);
  color:var(--rose2);
}

.btn-start {
  font-family:'Playfair Display',serif;
  font-style:italic;
  font-size:20px;
  padding:16px 56px;
  background:transparent;
  border:1px solid var(--gold);
  color:var(--gold2);
  cursor:pointer;
  letter-spacing:3px;
  transition:all .4s;
  position:relative;
  overflow:hidden;
}
.btn-start::after {
  content:'';
  position:absolute;
  inset:0;
  background:linear-gradient(135deg,rgba(200,149,42,.08),rgba(184,64,96,.08));
  opacity:0;
  transition:opacity .4s;
}
.btn-start:hover::after{opacity:1}
.btn-start:hover{box-shadow:0 0 30px rgba(200,149,42,.18);transform:translateY(-2px);}

/* â•â•â• POV BAR (fixed top) â•â•â• */
#pov-bar {
  position:fixed;
  top:0; left:0; right:0;
  z-index:200;
  background:linear-gradient(to bottom,rgba(7,5,10,.97) 70%,transparent);
  padding:14px 20px 28px;
  display:none;
  flex-direction:column;
  align-items:center;
  gap:8px;
}

.pov-label { font-family:'Bebas Neue',sans-serif; font-size:9px; letter-spacing:6px; color:var(--muted); }

.pov-row { display:flex; gap:6px; flex-wrap:wrap; justify-content:center; }

.pov-char {
  padding:4px 15px;
  border-radius:100px;
  border:1px solid var(--border);
  background:rgba(255,255,255,.03);
  color:var(--muted);
  font-family:'EB Garamond',serif;
  font-style:italic;
  font-size:15px;
  cursor:pointer;
  transition:all .25s;
  user-select:none;
}
.pov-char:hover { color:var(--gold2); border-color:rgba(200,149,42,.5); }
.pov-char.active { background:rgba(200,149,42,.12); border-color:var(--gold); color:var(--gold2); }

/* â•â•â• GAME AREA â•â•â• */
#game {
  display:none;
  max-width:780px;
  margin:0 auto;
  padding:110px 24px 80px;
}

.scene-bar {
  display:flex;
  align-items:center;
  gap:14px;
  margin-bottom:28px;
  padding-bottom:18px;
  border-bottom:1px solid var(--border);
}

.tag-pov {
  font-family:'Bebas Neue',sans-serif;
  font-size:10px;
  letter-spacing:4px;
  padding:3px 12px;
  border-radius:100px;
  background:rgba(200,149,42,.1);
  border:1px solid rgba(200,149,42,.3);
  color:var(--gold);
}
.tag-pov.rose { background:rgba(184,64,96,.1); border-color:rgba(184,64,96,.3); color:var(--rose2); }
.tag-pov.lilac { background:rgba(144,96,192,.1); border-color:rgba(144,96,192,.3); color:#c090ff; }
.tag-pov.teal { background:rgba(32,128,128,.1); border-color:rgba(32,128,128,.3); color:#60d0d0; }

.tag-loc { font-size:13px; color:var(--muted); font-style:italic; letter-spacing:1px; }

/* NARRATIVE */
.narr {
  font-size:19px;
  line-height:1.95;
  color:var(--cream);
  margin-bottom:36px;
  text-align:justify;
  animation: slideIn .5s ease both;
}
@keyframes slideIn { from{opacity:0;transform:translateY(12px)} to{opacity:1;transform:none} }

.narr i { color:var(--gold2); }
.narr b { color:var(--cream); font-style:normal; }

/* Character name colors in text */
.nMel { color:#e8b0c4; }
.nEllie { color:#80c8e8; }
.nCarluz { color:#98e898; }
.nEros { color:#e8c880; }
.nSte { color:#c890e8; }
.nMary { color:#80e8c0; }
.nJoy { color:#e88080; }

/* DIALOGUE BOX */
.dial {
  margin:16px 0;
  padding:14px 20px;
  border-left:2px solid rgba(200,149,42,.3);
  font-style:italic;
  animation: slideIn .4s ease both;
}
.dial .who {
  font-style:normal;
  font-family:'Bebas Neue',sans-serif;
  font-size:11px;
  letter-spacing:4px;
  color:var(--gold);
  margin-bottom:4px;
  display:block;
}
.dial.rose-d { border-left-color:rgba(184,64,96,.5); }
.dial.rose-d .who { color:var(--rose2); }
.dial.lilac-d { border-left-color:rgba(144,96,192,.5); }
.dial.lilac-d .who { color:#c090ff; }
.dial.teal-d { border-left-color:rgba(32,128,128,.5); }
.dial.teal-d .who { color:#60d0d0; }

/* NOTIFICATION: message from offscreen character */
.notif {
  display:flex;
  gap:12px;
  margin:18px 0;
  padding:12px 16px;
  background:rgba(255,255,255,.03);
  border:1px solid var(--border);
  border-radius:6px;
  font-size:15px;
  color:var(--muted);
  font-style:italic;
  animation: slideIn .4s ease both;
}
.notif-icon { font-size:18px; flex-shrink:0; margin-top:1px; }

/* CHOICES */
.choices {
  display:flex;
  flex-direction:column;
  gap:10px;
  margin-top:40px;
  animation: slideIn .5s .1s ease both;
}

.choice-btn {
  padding:16px 24px;
  background:rgba(255,255,255,.025);
  border:1px solid var(--border);
  color:var(--cream);
  font-family:'EB Garamond',serif;
  font-size:17px;
  font-style:italic;
  cursor:pointer;
  text-align:left;
  transition:all .3s;
  position:relative;
  overflow:hidden;
  line-height:1.5;
}

.choice-btn::before {
  content:'â†’';
  position:absolute;
  left:-20px;
  top:50%;
  transform:translateY(-50%);
  color:var(--gold2);
  transition:left .3s;
  font-style:normal;
}

.choice-btn:hover {
  border-color:rgba(200,149,42,.5);
  background:rgba(200,149,42,.05);
  padding-left:36px;
}
.choice-btn:hover::before { left:14px; }

.choice-btn.danger:hover {
  border-color:rgba(184,64,96,.5);
  background:rgba(184,64,96,.06);
}
.choice-btn.danger:hover::before { color:var(--rose2); }

/* POV SWITCH HINT */
.pov-hint {
  text-align:center;
  font-size:13px;
  color:var(--muted);
  letter-spacing:2px;
  margin-top:30px;
  opacity:.5;
}

/* ENDING SCREEN */
#ending-screen {
  display:none;
  max-width:780px;
  margin:0 auto;
  padding:80px 24px;
  text-align:center;
  animation:fadeIn 1s ease both;
}

.ending-label {
  font-family:'Bebas Neue',sans-serif;
  font-size:11px;
  letter-spacing:8px;
  color:var(--gold);
  margin-bottom:20px;
}

.ending-title {
  font-family:'Playfair Display',serif;
  font-size:clamp(36px,8vw,72px);
  font-weight:700;
  font-style:italic;
  line-height:1.1;
  margin-bottom:24px;
}

.ending-title.good { background:linear-gradient(135deg,var(--gold2),var(--rose2)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
.ending-title.bad { background:linear-gradient(135deg,var(--muted),#5a4060); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
.ending-title.chaos { background:linear-gradient(135deg,var(--rose2),var(--lilac)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
.ending-title.sweet { background:linear-gradient(135deg,#e8c880,#98e898); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }

.ending-text { font-size:18px; color:var(--muted); max-width:560px; margin:0 auto 40px; line-height:1.9; font-style:italic; }

.btn-restart {
  font-family:'EB Garamond',serif;
  font-style:italic;
  font-size:18px;
  padding:14px 48px;
  background:transparent;
  border:1px solid var(--border);
  color:var(--muted);
  cursor:pointer;
  transition:all .3s;
  letter-spacing:2px;
}
.btn-restart:hover { color:var(--cream); border-color:var(--gold); }

.ending-flag {
  font-size:13px;
  color:var(--muted);
  margin-top:20px;
  opacity:.5;
  letter-spacing:1px;
}

/* SCROLL custom */
::-webkit-scrollbar { width:4px; }
::-webkit-scrollbar-track { background:var(--bg); }
::-webkit-scrollbar-thumb { background:rgba(200,149,42,.2); border-radius:2px; }
</style>
</head>
<body>

<!-- TITLE -->
<div id="title-screen">
  <div class="eyebrow">Parte II</div>
  <div class="big-title">MANSÃƒO</div>
  <div class="sub">uma histÃ³ria sem fim</div>
  <div class="orn"></div>
  <div class="warning-box">âš ï¸ ConteÃºdo adulto â€” 18+ â€” TraiÃ§Ã£o, desejo, escolhas sem volta</div>
  <div class="cast-wrap">
    <span class="cast-pill">Mel</span>
    <span class="cast-pill">Ellie</span>
    <span class="cast-pill couple">â¤ Eros + Carluz â¤</span>
    <span class="cast-pill">Stephany</span>
    <span class="cast-pill">Mary</span>
    <span class="cast-pill">Joy</span>
  </div>
  <button class="btn-start" onclick="startGame()">Entrar na MansÃ£o</button>
</div>

<!-- POV BAR -->
<div id="pov-bar">
  <div class="pov-label">Trocar Perspectiva</div>
  <div class="pov-row" id="pov-row"></div>
</div>

<!-- GAME -->
<div id="game"></div>

<!-- ENDING -->
<div id="ending-screen" id="ending-screen">
  <div class="ending-label" id="ending-label">FIM</div>
  <div class="ending-title" id="ending-title"></div>
  <div class="ending-text" id="ending-text"></div>
  <button class="btn-restart" onclick="restart()">â†º Jogar novamente</button>
  <div class="ending-flag" id="ending-flag"></div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  GAME ENGINE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const CHARS = {
  Mel:     { color:'rose',   emoji:'ğŸ’”', desc:'A ferida ainda aberta' },
  Ellie:   { color:'teal',   emoji:'ğŸŒŠ', desc:'Quieta, perigosa' },
  Carluz:  { color:'gold',   emoji:'âš¡', desc:'Apaixonada, ciumenta' },
  Eros:    { color:'gold',   emoji:'ğŸ”¥', desc:'Intenso, dividido' },
  Stephany:{ color:'lilac',  emoji:'ğŸŒ¸', desc:'Observa tudo, diz pouco' },
  Mary:    { color:'teal',   emoji:'ğŸŒ¿', desc:'Nova demais pra sobreviver?' },
  Joy:     { color:'rose',   emoji:'ğŸ·', desc:'A culpada que voltou' },
};

let state = {
  pov: 'Mel',
  flags: {},    // story flags
  history: [],  // visited scene ids
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SCENES DATABASE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const SCENES = {

  // â”€â”€ OPENING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  intro: {
    pov: 'Mel',
    loc: 'Hall de entrada â€” noite de sexta',
    narr: `
      <p class="narr">A mansÃ£o cheira a vinho caro e a segredo. <span class="nMel">Mel</span> larga as malas no hall de mÃ¡rmore e olha para cima â€” o lustre derrama luz dourada sobre tudo, inclusive sobre o caos que estÃ¡ prestes a comeÃ§ar.</p>
      <p class="narr">Seis pessoas. Uma mansÃ£o. Sem regras claras.</p>
      <div class="dial rose-d"><span class="who">MEL</span>Se eu sobreviver esse fim de semana sem surtar, vai ser um milagre.</div>
      <div class="notif"><span class="notif-icon">ğŸ“±</span><span><b class="nCarluz">Carluz</b> mandou mensagem: <i>"Chega logo, tÃ´ morrendo de saudade de vc â€” e o Eros tÃ¡ sendo impossÃ­vel hoje ğŸ˜­"</i></span></div>
    `,
    choices: [
      { text: 'â†’ Subir pro quarto e descansar antes de encarar todo mundo', next: 'mel_quarto_chegada' },
      { text: 'â†’ Ir direto Ã  sala, todo mundo jÃ¡ estÃ¡ lÃ¡', next: 'sala_chegada' },
      { text: 'â†’ Procurar a Carluz primeiro', next: 'mel_encontra_carluz' },
    ],
    switchable: ['Mel','Carluz','Eros'],
  },

  // MEL â€” VAI PRO QUARTO
  mel_quarto_chegada: {
    pov: 'Mel',
    loc: 'Quarto da Mel â€” andar de cima',
    narr: `
      <p class="narr">O quarto dela tem vista pro jardim. <span class="nMel">Mel</span> joga a bolsa na cama e senta na beira. Respira fundo. Dois meses desde a Ãºltima vez que viu a <span class="nJoy">Joy</span> pessoalmente. Dois meses desde que tudo quebrou.</p>
      <p class="narr">Ela nem sabe se a Joy vai aparecer esse fim de semana. A Stephany disse <i>"talvez"</i>. Talvez Ã© pior do que sim.</p>
      <div class="notif"><span class="notif-icon">ğŸ‘‚</span><span>Do corredor, ela ouve a voz da <b class="nEllie">Ellie</b> â€” baixinha, mas clara. <i>"Ela ainda nÃ£o subiu?"</i></span></div>
      <div class="notif"><span class="notif-icon">ğŸ‘‚</span><span>E a voz da <b class="nSte">Stephany</b> respondendo: <i>"Deixa ela chegar no tempo dela."</i></span></div>
    `,
    choices: [
      { text: 'â†’ Abrir a porta e encarar o corredor', next: 'corredor_mel_ellie', flag: {mel_foi_quarto: true} },
      { text: 'â†’ Ficar no quarto por mais um tempo. Precisa de ar.', next: 'mel_quarto_joy_chega' },
    ],
    switchable: ['Mel','Ellie','Stephany'],
  },

  // MEL â€” QUARTO â€” JOY CHEGA
  mel_quarto_joy_chega: {
    pov: 'Mel',
    loc: 'Quarto da Mel',
    narr: `
      <p class="narr">Batida na porta. <span class="nMel">Mel</span> congela.</p>
      <div class="dial rose-d"><span class="who">VOZ DO CORREDOR</span>Mel? Sou eu.</div>
      <p class="narr">A voz da <span class="nJoy">Joy</span>. Ela veio.</p>
      <p class="narr">O coraÃ§Ã£o de Mel bate em dois tempos â€” raiva e algo que ela nÃ£o quer nomear. A porta nÃ£o tem fechadura. Se ela nÃ£o responder, Joy vai entrar de qualquer jeito. Sempre foi assim.</p>
    `,
    choices: [
      { text: 'â†’ Abrir a porta. Precisam conversar de uma vez.', next: 'mel_joy_confronto', flag: {mel_abriu_pra_joy: true}, cls: 'danger' },
      { text: 'â†’ Ficar em silÃªncio. Fingir que nÃ£o estÃ¡ aqui.', next: 'mel_ignora_joy' },
    ],
    switchable: ['Mel','Joy'],
  },

  // MEL â€” IGNORA JOY
  mel_ignora_joy: {
    pov: 'Mel',
    loc: 'Quarto da Mel',
    narr: `
      <p class="narr">SilÃªncio do lado de fora. Um segundo, dois. Depois passos se afastando.</p>
      <p class="narr"><span class="nMel">Mel</span> solta o ar que estava prendendo. Ã“timo. AtÃ© logo, pelo menos.</p>
      <div class="notif"><span class="notif-icon">ğŸ“±</span><span><b class="nCarluz">Carluz</b>: <i>"VocÃª viu que a Joy chegou?? ğŸ‘€ tÃ´ no jardim se quiser fugir junto"</i></span></div>
    `,
    choices: [
      { text: 'â†’ Ir pro jardim encontrar a Carluz', next: 'jardim_mel_carluz' },
      { text: 'â†’ Descer pra sala â€” encarar todo mundo de uma vez', next: 'sala_chegada' },
    ],
    switchable: ['Mel','Carluz','Joy'],
  },

  // MEL + JOY CONFRONTO
  mel_joy_confronto: {
    pov: 'Mel',
    loc: 'Quarto da Mel',
    narr: `
      <p class="narr">A <span class="nJoy">Joy</span> entra. Ela estÃ¡ diferente â€” cabelo mais curto, olheiras que o blush nÃ£o esconde. Fecha a porta com cuidado.</p>
      <div class="dial lilac-d"><span class="who">JOY</span>Eu sabia que vocÃª estava aqui. VocÃª nÃ£o consegue fingir que nÃ£o estÃ¡ em casa.</div>
      <div class="dial rose-d"><span class="who">MEL</span>Dois meses, Joy. Dois meses e agora vocÃª aparece aqui como se tudo tivesse bem?</div>
      <div class="dial lilac-d"><span class="who">JOY</span>Eu sei que nÃ£o tÃ¡ bem. Foi por isso que eu vim.</div>
      <p class="narr">Ela se aproxima. <span class="nMel">Mel</span> nÃ£o recua â€” mas o coraÃ§Ã£o dispara.</p>
    `,
    choices: [
      { text: 'â†’ "O que vocÃª quer, Joy?"', next: 'mel_joy_beijo', cls: 'danger', flag: {mel_ouviu_joy: true} },
      { text: 'â†’ "Sai do meu quarto."', next: 'mel_joy_expulsa' },
      { text: 'â†’ Ficar em silÃªncio. Deixar ela falar.', next: 'mel_joy_confissao' },
    ],
    switchable: ['Mel','Joy'],
  },

  // MEL + JOY â€” BEIJO
  mel_joy_beijo: {
    pov: 'Mel',
    loc: 'Quarto da Mel',
    narr: `
      <p class="narr">A <span class="nJoy">Joy</span> engole em seco.</p>
      <div class="dial lilac-d"><span class="who">JOY</span>Te quero de volta. Sei que nÃ£o tenho direito de pedir isso. Mas Ã© o que Ã©.</div>
      <p class="narr">O silÃªncio dura tempo demais. E entÃ£o a distÃ¢ncia entre elas some â€” nÃ£o tem como dizer quem se moveu primeiro.</p>
      <p class="narr">O beijo Ã© raivoso e macio ao mesmo tempo. <span class="nMel">Mel</span> odeia como sente falta disso. Odeia mais ainda que a Joy sabe disso.</p>
      <div class="notif"><span class="notif-icon">ğŸšª</span><span>A porta se abre. <b class="nEllie">Ellie</b> para no vÃ£o. Olha para as duas. <i>NÃ£o diz nada.</i> Fecha a porta.</span></div>
    `,
    choices: [
      { text: 'â†’ Ir atrÃ¡s da Ellie â€” ela nÃ£o pode achar que...', next: 'mel_corre_tras_ellie', flag: {ellie_viu_beijo: true} },
      { text: 'â†’ Ficar com a Joy. O que a Ellie pensa nÃ£o Ã© problema seu.', next: 'mel_fica_com_joy', cls: 'danger', flag: {mel_escolheu_joy: true} },
    ],
    switchable: ['Mel','Joy','Ellie'],
  },

  // ELLIE VAI EMBORA
  mel_corre_tras_ellie: {
    pov: 'Mel',
    loc: 'Corredor â€” andar de cima',
    narr: `
      <p class="narr"><span class="nMel">Mel</span> sai correndo. A <span class="nEllie">Ellie</span> jÃ¡ estÃ¡ na escada â€” caminha rÃ¡pido, ombros tensos.</p>
      <div class="dial rose-d"><span class="who">MEL</span>Ellie. Para.</div>
      <p class="narr">Ela para. NÃ£o se vira.</p>
      <div class="dial rose-d"><span class="who">MEL</span>NÃ£o Ã© o que parece.</div>
      <div class="dial teal-d"><span class="who">ELLIE</span>NÃ£o precisa explicar nada pra mim, Mel.</div>
      <p class="narr">A frieza na voz dela dÃ³i mais do que raiva teria doÃ­do.</p>
    `,
    choices: [
      { text: 'â†’ "Ellie, eu me importo com o que vocÃª acha."', next: 'ellie_mel_revelacao', cls: 'danger', flag: {mel_admitiu_pra_ellie: true} },
      { text: 'â†’ Deixar ela ir. NÃ£o Ã© hora.', next: 'sala_chegada' },
    ],
    switchable: ['Mel','Ellie'],
  },

  // â”€â”€ PERSPECTIVA: ELLIE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  ellie_pov_inicio: {
    pov: 'Ellie',
    loc: 'Biblioteca â€” andar de cima',
    narr: `
      <p class="narr"><span class="nEllie">Ellie</span> estÃ¡ no lugar que sempre ocupou nessa mansÃ£o â€” o canto que ninguÃ©m procura. A biblioteca tem cheiro de madeira antiga e ela estÃ¡ sentada no chÃ£o com as costas na prateleira.</p>
      <p class="narr">Ela ouviu as malas da <span class="nMel">Mel</span> chegando. Ouviu a voz da <span class="nJoy">Joy</span>. Optou por nÃ£o descer.</p>
      <p class="narr"><span class="nEllie">Ellie</span> sabe de uma coisa que mais ninguÃ©m sabe ainda: ela estÃ¡ apaixonada pela Mel hÃ¡ muito mais tempo do que deveria.</p>
    `,
    choices: [
      { text: 'â†’ Descer e se jogar no drama â€” melhor do que ficar aqui pensando', next: 'sala_chegada_ellie' },
      { text: 'â†’ Ficar. Ver o que aparece pela janela do corredor.', next: 'ellie_janela_jardim' },
    ],
    switchable: ['Ellie','Mel','Stephany'],
  },

  ellie_janela_jardim: {
    pov: 'Ellie',
    loc: 'Corredor â€” janela sul',
    narr: `
      <p class="narr">Do corredor, <span class="nEllie">Ellie</span> vÃª o jardim iluminado. A <span class="nCarluz">Carluz</span> estÃ¡ sentada na beira da fonte, tomando vinho direto da garrafa. O <span class="nEros">Eros</span> aparece pela porta do jardim e ela se levanta de um salto â€” discussÃ£o baixa, gestual exagerado.</p>
      <p class="narr">Eles brigam bonito, esses dois. Violentamente apaixonados um pelo outro e violentamente capazes de se machucar.</p>
      <div class="notif"><span class="notif-icon">ğŸ“±</span><span><b class="nSte">Stephany</b>: <i>"Ellie cadÃª vc?? Preciso de vocÃª aqui AGORA"</i></span></div>
    `,
    choices: [
      { text: 'â†’ Ir atÃ© a Stephany â€” ela nunca pede ajuda sem motivo', next: 'ellie_stephany_segredo' },
      { text: 'â†’ Ir pro jardim â€” quer muito saber o que Eros e Carluz estÃ£o brigando', next: 'jardim_eros_carluz_ellie' },
    ],
    switchable: ['Ellie','Stephany','Carluz','Eros'],
  },

  // ELLIE + STEPHANY
  ellie_stephany_segredo: {
    pov: 'Ellie',
    loc: 'Quarto da Stephany',
    narr: `
      <p class="narr">A <span class="nSte">Stephany</span> fecha a porta antes de <span class="nEllie">Ellie</span> terminar de entrar. Parece... nervosa? Stephany quase nunca parece nervosa.</p>
      <div class="dial lilac-d"><span class="who">STEPHANY</span>Eu preciso que vocÃª nÃ£o conte pra ninguÃ©m o que vou te falar.</div>
      <div class="dial teal-d"><span class="who">ELLIE</span>TÃ¡ comeÃ§ando Ã³timo.</div>
      <div class="dial lilac-d"><span class="who">STEPHANY</span>Eu e a Mary... desde a semana passada. Foi sem querer. Foi uma merda. NÃ£o sei o que tÃ¡ acontecendo.</div>
      <p class="narr"><span class="nEllie">Ellie</span> processa isso por um segundo.</p>
      <div class="dial teal-d"><span class="who">ELLIE</span>A Mary que a gente trouxe pra cÃ¡ porque ela "nÃ£o conhece ninguÃ©m na cidade"?</div>
      <div class="dial lilac-d"><span class="who">STEPHANY</span>Essa.</div>
    `,
    choices: [
      { text: 'â†’ "VocÃª gosta dela de verdade ou foi sÃ³ uma coisa do momento?"', next: 'stephany_ellie_mary_futuro', flag: {ste_mary_revelado: true} },
      { text: 'â†’ NÃ£o julgar. SÃ³ ouvir.', next: 'ellie_apoia_stephany' },
      { text: 'â†’ "Isso vai explodir. VocÃª sabe disso, nÃ©?"', next: 'stephany_aviso', cls: 'danger' },
    ],
    switchable: ['Ellie','Stephany','Mary'],
  },

  stephany_aviso: {
    pov: 'Ellie',
    loc: 'Quarto da Stephany',
    narr: `
      <p class="narr">A <span class="nSte">Stephany</span> ri sem graÃ§a.</p>
      <div class="dial lilac-d"><span class="who">STEPHANY</span>Eu sei. Ã‰ por isso que eu tÃ´ te contando.</div>
      <div class="dial teal-d"><span class="who">ELLIE</span>O que vocÃª quer que eu faÃ§a?</div>
      <div class="dial lilac-d"><span class="who">STEPHANY</span>Ficar do meu lado quando explodir.</div>
    `,
    choices: [
      { text: 'â†’ "Sempre." AbraÃ§ar ela.', next: 'ellie_abraca_ste', flag: {ellie_prometeu_ste: true} },
      { text: 'â†’ Mudar de assunto â€” vocÃª precisa processar isso', next: 'ellie_janela_jardim' },
    ],
    switchable: ['Ellie','Stephany'],
  },

  // â”€â”€ PERSPECTIVA: CARLUZ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  jardim_eros_carluz: {
    pov: 'Carluz',
    loc: 'Jardim â€” fonte de pedra',
    narr: `
      <p class="narr"><span class="nCarluz">Carluz</span> ouviu os passos do <span class="nEros">Eros</span> antes de vÃª-lo. Dois anos junto e ela ainda reconhece o jeito que ele anda quando estÃ¡ com raiva â€” rÃ¡pido, aterrado.</p>
      <div class="dial teal-d"><span class="who">EROS</span>VocÃª foi falar com a Mary de novo.</div>
      <div class="dial rose-d"><span class="who">CARLUZ</span>Ela nÃ£o tem ninguÃ©m aqui, Eros. AlguÃ©m tem queâ€”</div>
      <div class="dial teal-d"><span class="who">EROS</span>VocÃª nÃ£o tÃ¡ fazendo isso por ela. VocÃª tÃ¡ evitando conversar comigo.</div>
      <p class="narr">SilÃªncio. Ele acertou e os dois sabem.</p>
    `,
    choices: [
      { text: 'â†’ "VocÃª tem razÃ£o." Admitir.', next: 'carluz_eros_briga_real', flag: {carluz_admitiu: true} },
      { text: 'â†’ "NÃ£o Ã© verdade." Segurar.', next: 'carluz_nega' },
      { text: 'â†’ Mudar de assunto â€” beijÃ¡-lo antes que piore', next: 'carluz_eros_beijo_jardim', cls: 'danger' },
    ],
    switchable: ['Carluz','Eros'],
  },

  carluz_eros_beijo_jardim: {
    pov: 'Carluz',
    loc: 'Jardim â€” fonte',
    narr: `
      <p class="narr"><span class="nCarluz">Carluz</span> pega a camisa dele e puxa. O <span class="nEros">Eros</span> hesita um segundo â€” sempre hesita, mas sempre cede.</p>
      <p class="narr">O beijo tem gosto de vinho e de conversa evitada. Ele a segura pela cintura, e por um momento tudo fica suspenso â€” a briga, a mansÃ£o, as outras pessoas.</p>
      <p class="narr">Por um momento.</p>
      <div class="notif"><span class="notif-icon">ğŸ‘ï¸</span><span>Da janela do corredor, uma silhueta observa. <span class="nEllie">Ellie</span>? <span class="nMary">Mary</span>? DifÃ­cil dizer na penumbra.</span></div>
    `,
    choices: [
      { text: 'â†’ Ignorar. NinguÃ©m precisa saber de tudo.', next: 'carluz_eros_quarto', flag: {carluz_eros_jardim: true} },
      { text: 'â†’ Parar o beijo â€” quem estava olhando?', next: 'carluz_procura_janela' },
    ],
    switchable: ['Carluz','Eros','Ellie','Mary'],
  },

  carluz_eros_quarto: {
    pov: 'Carluz',
    loc: 'Quarto do casal â€” mansÃ£o',
    narr: `
      <p class="narr">O quarto deles Ã© o maior da mansÃ£o â€” irÃ´nico, porque Ã s vezes parece pequeno demais pra eles dois.</p>
      <p class="narr"><span class="nCarluz">Carluz</span> e <span class="nEros">Eros</span> entram pelo corredor, mÃ£os entrelaÃ§adas. A briga ainda estÃ¡ ali, como uma brasa, mas agora tem outra coisa tambÃ©m.</p>
      <p class="narr">Ele fecha a porta. Olha pra ela.</p>
      <div class="dial teal-d"><span class="who">EROS</span>A gente nÃ£o resolveu nada lÃ¡ fora, sabia?</div>
      <div class="dial rose-d"><span class="who">CARLUZ</span>Eu sei. Mas eu quis te beijar antes de resolver. Sempre quis.</div>
      <p class="narr">Ele sorri â€” aquele sorriso que ela odeia porque faz ela esquecer de estar com raiva.</p>
    `,
    choices: [
      { text: 'â†’ Deixar a noite acontecer. Brigar depois.', next: 'carluz_eros_noite', flag: {eros_carluz_intenso: true}, cls: 'danger' },
      { text: 'â†’ Conversar de verdade. Agora, enquanto estÃ£o os dois.', next: 'carluz_eros_briga_real' },
    ],
    switchable: ['Carluz','Eros'],
  },

  carluz_eros_noite: {
    pov: 'Carluz',
    loc: 'Quarto do casal',
    narr: `
      <p class="narr">A noite deles tem a intensidade de quem sabe que pode perder o outro â€” e talvez por isso segura mais forte.</p>
      <p class="narr">Depois, <span class="nCarluz">Carluz</span> fica acordada olhando pro teto enquanto o <span class="nEros">Eros</span> dorme. A brasa ainda estÃ¡ lÃ¡. As perguntas nÃ£o foram embora.</p>
      <p class="narr">Mas ela estÃ¡ aqui. E ele estÃ¡ aqui. Por enquanto, isso tem que ser suficiente.</p>
      <div class="notif"><span class="notif-icon">ğŸ“±</span><span><b class="nMary">Mary</b>: <i>"vc tÃ¡ bem? preciso falar com vc amanhÃ£ cedo"</i></span></div>
    `,
    choices: [
      { text: 'â†’ [ManhÃ£ seguinte] Ir falar com a Mary', next: 'carluz_mary_manha' },
      { text: 'â†’ [ManhÃ£ seguinte] Acordar o Eros â€” a conversa nÃ£o pode esperar mais', next: 'carluz_eros_briga_real' },
    ],
    switchable: ['Carluz','Eros','Mary'],
  },

  // â”€â”€ PERSPECTIVA: EROS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  eros_pov_sozinho: {
    pov: 'Eros',
    loc: 'Varanda do fundo â€” madrugada',
    narr: `
      <p class="narr"><span class="nEros">Eros</span> saiu sem acordar a <span class="nCarluz">Carluz</span>. NÃ£o conseguia dormir.</p>
      <p class="narr">Ele fuma apoiado no corrimÃ£o, olhando pro jardim escuro. Pensa em coisas que nÃ£o devia pensar.</p>
      <p class="narr">Pensa na conversa que teve com a <span class="nMary">Mary</span> na semana passada â€” ela perguntou sobre ele e a Carluz, olhando com aqueles olhos que fazem as perguntas parecerem maiores. Ele respondeu mais do que devia.</p>
      <p class="narr">NÃ£o aconteceu nada. Mas o <i>quase</i> tem peso prÃ³prio.</p>
    `,
    choices: [
      { text: 'â†’ Voltar pro quarto. A Carluz Ã© o que importa.', next: 'eros_volta_carluz', flag: {eros_escolheu_carluz: true} },
      { text: 'â†’ Ficar mais um pouco. Pensar.', next: 'eros_mary_varanda', cls: 'danger' },
    ],
    switchable: ['Eros','Carluz','Mary'],
  },

  eros_mary_varanda: {
    pov: 'Eros',
    loc: 'Varanda do fundo',
    narr: `
      <p class="narr">A porta da varanda se abre. <span class="nEros">Eros</span> nÃ£o precisa se virar pra saber quem Ã©.</p>
      <div class="dial teal-d"><span class="who">MARY</span>NÃ£o conseguia dormir tambÃ©m.</div>
      <p class="narr">Ela fica do lado dele, a distÃ¢ncia certa pra nÃ£o ser suspeita, a distÃ¢ncia errada pra ele conseguir ignorar.</p>
      <div class="dial teal-d"><span class="who">EROS</span>VocÃª devia voltar pra dentro, Mary.</div>
      <div class="dial teal-d"><span class="who">MARY</span>Devia. <i>(pausa)</i> Mas nÃ£o quero.</div>
    `,
    choices: [
      { text: 'â†’ Ser honesto: "Isso nÃ£o pode acontecer."', next: 'eros_recusa_mary', flag: {eros_recusou_mary: true} },
      { text: 'â†’ NÃ£o dizer nada. Deixar o silÃªncio ser o que for.', next: 'eros_silencio_mary', cls: 'danger', flag: {eros_fraquejou: true} },
    ],
    switchable: ['Eros','Mary','Carluz'],
  },

  eros_silencio_mary: {
    pov: 'Eros',
    loc: 'Varanda â€” madrugada',
    narr: `
      <p class="narr">O silÃªncio dura o suficiente pra se tornar cumplicidade.</p>
      <p class="narr"><span class="nMary">Mary</span> olha pra ele. Ele olha pra frente. Ela coloca a mÃ£o sobre a dele no corrimÃ£o â€” um gesto pequeno, que caberia em outra vida como inocente.</p>
      <p class="narr">NÃ£o cabe.</p>
      <p class="narr"><span class="nEros">Eros</span> retira a mÃ£o. Mas demora um segundo a mais do que devia.</p>
      <div class="notif"><span class="notif-icon">ğŸšª</span><span>A porta da varanda se abre de novo. <b class="nCarluz">Carluz</b> para no vÃ£o. Olha pra <b class="nEros">Eros</b>. Olha pra <b class="nMary">Mary</b>. Entende sem que ninguÃ©m explique.</span></div>
    `,
    choices: [
      { text: 'â†’ [Como Eros] Ir atÃ© a Carluz imediatamente', next: 'eros_carluz_confronto_varanda', flag: {carluz_viu_varanda: true} },
      { text: 'â†’ Mudar pra perspectiva da Carluz â€” ver o que ela sente agora', next: 'carluz_viu_varanda' },
    ],
    switchable: ['Eros','Carluz','Mary'],
  },

  // CARLUZ VÃŠ A VARANDA
  carluz_viu_varanda: {
    pov: 'Carluz',
    loc: 'Varanda â€” madrugada',
    narr: `
      <p class="narr"><span class="nCarluz">Carluz</span> acordou com o lado da cama vazio. Dois anos e ela ainda nÃ£o se acostumou com a ausÃªncia dele quando ela acorda.</p>
      <p class="narr">Ela o encontrou na varanda. Com a <span class="nMary">Mary</span>.</p>
      <p class="narr">NÃ£o havia nada acontecendo. Ela sabe distinguir. Mas o jeito que eles dois se afastaram ao mesmo tempo quando ela apareceu â€” esse reflexo culpado â€” diz tudo que ela precisava saber sobre o <i>potencial</i>.</p>
    `,
    choices: [
      { text: 'â†’ Explodir agora. NÃ£o consegue fingir que nÃ£o viu.', next: 'carluz_explode_varanda', cls: 'danger' },
      { text: 'â†’ Sorrir e voltar pro quarto. Guardar para o momento certo.', next: 'carluz_guarda_magoa', flag: {carluz_magoa_silenciosa: true} },
      { text: 'â†’ Olhar diretamente pra Mary: "Boa noite, Mary."', next: 'carluz_confronta_mary_suave' },
    ],
    switchable: ['Carluz','Eros','Mary'],
  },

  // â”€â”€ MARY â€” PERSPECTIVA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  mary_pov: {
    pov: 'Mary',
    loc: 'Quarto dela â€” noite',
    narr: `
      <p class="narr"><span class="nMary">Mary</span> estÃ¡ deitada de olhos abertos. Ela chegou nessa mansÃ£o porque a <span class="nCarluz">Carluz</span> disse <i>"vocÃª vai adorar todo mundo, Ã© uma famÃ­lia"</i>.</p>
      <p class="narr">FamÃ­lia. A palavra que cobre tudo enquanto nada estÃ¡ em ordem.</p>
      <p class="narr">Em trÃªs dias ela jÃ¡: ficou confusa com o <span class="nEros">Eros</span>, foi beijada pela <span class="nSte">Stephany</span>, e testemunhou o drama completo entre a <span class="nMel">Mel</span> e a <span class="nJoy">Joy</span>. Ela veio pra cÃ¡ sem bagagem emocional. EstÃ¡ saindo cheia de caixas.</p>
    `,
    choices: [
      { text: 'â†’ Tentar dormir. AmanhÃ£ Ã© um novo dia.', next: 'mary_manha_jardim' },
      { text: 'â†’ Ir atÃ© a varanda â€” nÃ£o consegue ficar parada', next: 'eros_mary_varanda' },
      { text: 'â†’ Ir bater na porta da Stephany â€” precisa entender o que foi aquele beijo', next: 'mary_stephany_noite' },
    ],
    switchable: ['Mary','Stephany','Eros'],
  },

  mary_stephany_noite: {
    pov: 'Mary',
    loc: 'Corredor â€” frente ao quarto da Stephany',
    narr: `
      <p class="narr"><span class="nMary">Mary</span> levanta a mÃ£o pra bater na porta. Para.</p>
      <p class="narr">O que ela vai dizer? <i>"Ei, vocÃª me beijou na semana passada e desde entÃ£o fingiu que nÃ£o aconteceu, pode me explicar?"</i></p>
      <p class="narr">Ela bate mesmo assim.</p>
      <p class="narr">A <span class="nSte">Stephany</span> abre a porta. Cabelo bagunÃ§ado, olhos semicerrados. Quando vÃª Mary, acorda de vez.</p>
      <div class="dial lilac-d"><span class="who">STEPHANY</span>Mary.</div>
      <div class="dial teal-d"><span class="who">MARY</span>NÃ£o vou fingir que nÃ£o aconteceu.</div>
    `,
    choices: [
      { text: 'â†’ Stephany abre a porta mais. "Entre."', next: 'mary_stephany_conversa', flag: {mary_ste_conversa: true} },
      { text: 'â†’ Stephany: "Agora nÃ£o Ã© hora." E fecha a porta.', next: 'mary_rejeitada_ste', flag: {mary_rejeitada: true} },
    ],
    switchable: ['Mary','Stephany'],
  },

  mary_stephany_conversa: {
    pov: 'Mary',
    loc: 'Quarto da Stephany',
    narr: `
      <p class="narr">Elas ficam sentadas na beira da cama, ombro com ombro, sem se tocar. A <span class="nSte">Stephany</span> fala devagar, como se estivesse descobrindo as palavras enquanto as diz.</p>
      <div class="dial lilac-d"><span class="who">STEPHANY</span>Eu nÃ£o sei o que tÃ´ sentindo. E isso me assusta porque eu sempre sei.</div>
      <div class="dial teal-d"><span class="who">MARY</span>Eu tambÃ©m nÃ£o sei. Mas acho que a gente devia tentar descobrir em vez de fugir.</div>
      <p class="narr">SilÃªncio. <span class="nSte">Stephany</span> olha pra ela â€” aquele olhar de quem estÃ¡ calculando todos os riscos ao mesmo tempo.</p>
      <p class="narr">E depois para de calcular.</p>
    `,
    choices: [
      { text: 'â†’ Deixar o momento acontecer', next: 'mary_stephany_momento', cls: 'danger', flag: {ste_mary_junto: true} },
      { text: 'â†’ "Mas vocÃª devia dormir. A gente conversa de dia."', next: 'mary_manha_jardim' },
    ],
    switchable: ['Mary','Stephany'],
  },

  // â”€â”€ SALA â€” CENA CONJUNTA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  sala_chegada: {
    pov: 'Mel',
    loc: 'Sala principal â€” noite',
    narr: `
      <p class="narr">A sala da mansÃ£o tem teto alto e janelas do chÃ£o ao teto. Todo mundo estÃ¡ aqui agora â€” a <span class="nCarluz">Carluz</span> no sofÃ¡ com o <span class="nEros">Eros</span>, a <span class="nSte">Stephany</span> perto da lareira, a <span class="nEllie">Ellie</span> com um livro que ela claramente nÃ£o estÃ¡ lendo, a <span class="nMary">Mary</span> tentando parecer Ã  vontade.</p>
      <p class="narr">E a <span class="nJoy">Joy</span>. Encostada na parede, copo de vinho na mÃ£o, olhos buscando a <span class="nMel">Mel</span> quando ela entra.</p>
      <p class="narr">A temperatura da sala sobe dois graus.</p>
      <div class="dial rose-d"><span class="who">CARLUZ</span><i>(para Mel)</i> Finalmente! TÃ´ te esperando hÃ¡ uma hora.</div>
    `,
    choices: [
      { text: 'â†’ Sentar do lado da Carluz â€” zona segura', next: 'sala_mel_carluz_conversa' },
      { text: 'â†’ Sentar do lado da Ellie â€” vocÃª precisa de alguÃ©m quieto agora', next: 'sala_mel_ellie' },
      { text: 'â†’ Encarar a Joy de frente â€” acabar com o elefante na sala', next: 'sala_mel_joy_publica', cls: 'danger' },
      { text: 'â†’ Mudar perspectiva â€” o que a Ellie estÃ¡ pensando nesse momento?', next: 'ellie_sala_pov' },
    ],
    switchable: ['Mel','Ellie','Carluz','Eros','Stephany','Mary','Joy'],
  },

  ellie_sala_pov: {
    pov: 'Ellie',
    loc: 'Sala principal',
    narr: `
      <p class="narr">O livro aberto no colo da <span class="nEllie">Ellie</span> Ã© uma mentira elaborada. Ela nÃ£o leu uma linha desde que a <span class="nMel">Mel</span> entrou na sala.</p>
      <p class="narr">Ela vÃª tudo: a <span class="nJoy">Joy</span> devorando a Mel com os olhos, a Carluz fazendo de conta que nÃ£o percebe a tensÃ£o, o <span class="nEros">Eros</span> olhando discretamente pra <span class="nMary">Mary</span>. Todo esse caos humano.</p>
      <p class="narr">E no meio disso, a Mel. Que entrou no quarto dela mais cedo e encontrou o que nÃ£o devia encontrar. E correu atrÃ¡s de Ellie. E disse <i>"eu me importo com o que vocÃª acha."</i></p>
      <p class="narr"><span class="nEllie">Ellie</span> fecha o livro.</p>
    `,
    choices: [
      { text: 'â†’ Ir sentar do lado da Mel', next: 'ellie_senta_mel', flag: {ellie_se_moveu: true} },
      { text: 'â†’ Observar mais um pouco. Ellie sobrevive observando.', next: 'ellie_observa_sala' },
    ],
    switchable: ['Ellie','Mel','Joy'],
  },

  ellie_senta_mel: {
    pov: 'Ellie',
    loc: 'Sala â€” sofÃ¡ lateral',
    narr: `
      <p class="narr"><span class="nEllie">Ellie</span> senta do lado da <span class="nMel">Mel</span>. NÃ£o diz nada. Mel tambÃ©m nÃ£o. Mas seus ombros se encostam, e nenhuma das duas se afasta.</p>
      <p class="narr">A <span class="nJoy">Joy</span> vÃª isso do outro lado da sala. Toma um gole do vinho.</p>
      <div class="dial teal-d"><span class="who">ELLIE</span><i>(bem baixinho, sÃ³ pra Mel)</i> VocÃª nÃ£o precisa de mim te protegendo. Mas se quiser, tÃ´ aqui.</div>
      <div class="dial rose-d"><span class="who">MEL</span><i>(bem baixinho)</i> Quero.</div>
    `,
    choices: [
      { text: 'â†’ A noite continua. O que acontece quando todos se separam?', next: 'madrugada_mansao' },
      { text: 'â†’ A Joy se levanta e vai atÃ© elas â€” tensÃ£o mÃ¡xima', next: 'joy_vai_ate_ellie_mel', cls: 'danger' },
    ],
    switchable: ['Ellie','Mel','Joy'],
  },

  // â”€â”€ MADRUGADA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  madrugada_mansao: {
    pov: 'Mel',
    loc: 'MansÃ£o â€” 2h da manhÃ£',
    narr: `
      <p class="narr">A mansÃ£o dorme em camadas. Alguns dormem de verdade. Outros fingem.</p>
      <p class="narr"><span class="nMel">Mel</span> estÃ¡ acordada. Sabe que a <span class="nEllie">Ellie</span> tambÃ©m estÃ¡ â€” hÃ¡ luz embaixo da porta do quarto dela.</p>
      <div class="notif"><span class="notif-icon">ğŸ“±</span><span><b class="nJoy">Joy</b>: <i>"TÃ´ na cozinha se quiser conversar. Sem pressÃ£o."</i></span></div>
      <div class="notif"><span class="notif-icon">ğŸ“±</span><span><b class="nEllie">Ellie</b>: <i>"Ainda acordada?"</i></span></div>
    `,
    choices: [
      { text: 'â†’ Responder a Ellie: "Sim. VocÃª tambÃ©m?"', next: 'mel_ellie_noite', flag: {mel_escolheu_ellie: true} },
      { text: 'â†’ Ir pra cozinha onde estÃ¡ a Joy', next: 'mel_joy_cozinha', cls: 'danger' },
      { text: 'â†’ NÃ£o responder nenhuma. Tentar dormir.', next: 'dia_seguinte_tensao' },
    ],
    switchable: ['Mel','Ellie','Joy'],
  },

  mel_ellie_noite: {
    pov: 'Mel',
    loc: 'Corredor â€” entre dois quartos',
    narr: `
      <p class="narr">Elas se encontram no corredor escuro, as duas de pijama, as duas parecendo um pouco perdidas.</p>
      <p class="narr"><span class="nEllie">Ellie</span> ri com os olhos. Mel tambÃ©m.</p>
      <div class="dial teal-d"><span class="who">ELLIE</span>A gente podia ir lÃ¡ fora. No jardim. TÃ¡ frio mas Ã© melhor que ficar pensando.</div>
      <div class="dial rose-d"><span class="who">MEL</span>VocÃª me conhece muito bem.</div>
      <div class="dial teal-d"><span class="who">ELLIE</span>Sei.</div>
    `,
    choices: [
      { text: 'â†’ Ir pro jardim com ela', next: 'jardim_mel_ellie_noite', flag: {mel_ellie_jardim: true} },
    ],
    switchable: ['Mel','Ellie'],
  },

  jardim_mel_ellie_noite: {
    pov: 'Mel',
    loc: 'Jardim â€” madrugada',
    narr: `
      <p class="narr">O jardim Ã  noite Ã© outra coisa. Frio, quieto, honesto.</p>
      <p class="narr">Elas ficam na beira da fonte onde horas antes o <span class="nEros">Eros</span> e a <span class="nCarluz">Carluz</span> brigaram. <span class="nMel">Mel</span> conta sobre o beijo com a Joy. A <span class="nEllie">Ellie</span> ouve sem interromper.</p>
      <div class="dial teal-d"><span class="who">ELLIE</span>O que vocÃª quer, Mel? NÃ£o o que Ã© certo. O que vocÃª quer.</div>
      <p class="narr">Ã‰ a pergunta errada na hora certa. <span class="nMel">Mel</span> olha pra ela. Ellie olha de volta â€” sem pressa, sem medo.</p>
    `,
    choices: [
      { text: 'â†’ "NÃ£o sei." (honesta)', next: 'mel_ellie_nao_sei', flag: {mel_honesta_ellie: true} },
      { text: 'â†’ NÃ£o responder com palavras', next: 'mel_ellie_primeiro_momento', cls: 'danger', flag: {mel_ellie_juntas: true} },
    ],
    switchable: ['Mel','Ellie'],
  },

  mel_ellie_primeiro_momento: {
    pov: 'Mel',
    loc: 'Jardim â€” fonte',
    narr: `
      <p class="narr">O espaÃ§o entre elas desaparece devagar â€” nÃ£o como com a Joy, que sempre foi urgente. Com a <span class="nEllie">Ellie</span> Ã© como respirar fundo.</p>
      <p class="narr">O beijo Ã© suave. Ellie coloca a mÃ£o na bochecha de Mel como se ela fosse quebrar. Mel nÃ£o quebra. Pela primeira vez em muito tempo, nÃ£o quebra.</p>
      <p class="narr">Quando elas se separam, a <span class="nEllie">Ellie</span> estÃ¡ com os olhos fechados ainda.</p>
      <div class="dial teal-d"><span class="who">ELLIE</span>TÃ´ apaixonada por vocÃª faz tempo. Precisava dizer.</div>
    `,
    choices: [
      { text: 'â†’ "Eu sei." E ficar com ela.', next: 'ending_mel_ellie', flag: {mel_ellie_final: true} },
      { text: 'â†’ "Ellie... eu nÃ£o sei se tÃ´ pronta."', next: 'mel_nao_pronta' },
    ],
    switchable: ['Mel','Ellie','Joy'],
  },

  // â”€â”€ CENAS DE CONFRONTO GERAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  dia_seguinte_tensao: {
    pov: 'Mel',
    loc: 'Cozinha â€” manhÃ£',
    narr: `
      <p class="narr">A manhÃ£ chega e todo mundo estÃ¡ na cozinha ao mesmo tempo, que Ã© exatamente o tipo de coisa que a <span class="nMansao">mansÃ£o</span> forÃ§a.</p>
      <p class="narr"><span class="nCarluz">Carluz</span> estÃ¡ em silÃªncio â€” o silÃªncio que nÃ£o Ã© paz, Ã© acumulaÃ§Ã£o. O <span class="nEros">Eros</span> faz cafÃ© olhando pro chÃ£o. A <span class="nMary">Mary</span> estÃ¡ sentada na mesa fingindo ler o celular. A <span class="nSte">Stephany</span> olha pra Mary com aquele olhar que todo mundo vai perceber se nÃ£o tiver cuidado.</p>
      <p class="narr">E entÃ£o a <span class="nCarluz">Carluz</span> coloca a xÃ­cara na pia e diz:</p>
      <div class="dial rose-d"><span class="who">CARLUZ</span>Precisamos conversar. Todos. Agora.</div>
    `,
    choices: [
      { text: 'â†’ A bomba explode â€” o grande confronto comeÃ§a', next: 'grande_confronto', cls: 'danger' },
      { text: 'â†’ Ver isso pela perspectiva do Eros', next: 'eros_confronto_pov' },
      { text: 'â†’ Ver isso pela perspectiva da Mary', next: 'mary_confronto_pov' },
    ],
    switchable: ['Mel','Carluz','Eros','Mary','Stephany','Ellie','Joy'],
  },

  grande_confronto: {
    pov: 'Carluz',
    loc: 'Cozinha â€” manhÃ£',
    narr: `
      <p class="narr">Todos ficam parados. <span class="nCarluz">Carluz</span> respira fundo.</p>
      <div class="dial rose-d"><span class="who">CARLUZ</span>Eu vi vocÃªs dois na varanda.</div>
      <p class="narr">Olhos no <span class="nEros">Eros</span>. Depois na <span class="nMary">Mary</span>. Ele abre a boca. Ela abre a mÃ£o.</p>
      <div class="dial rose-d"><span class="who">CARLUZ</span>NÃ£o aconteceu nada. Eu sei. Mas o <i>quase</i> tambÃ©m conta, Eros.</div>
      <p class="narr">SilÃªncio pesado. EntÃ£o a <span class="nSte">Stephany</span>, surpreendentemente, se levanta.</p>
      <div class="dial lilac-d"><span class="who">STEPHANY</span>JÃ¡ que a gente tÃ¡ sendo honesta â€” eu e a Mary.</div>
      <p class="narr">Pausa. ExplosÃ£o silenciosa em slow motion.</p>
      <div class="dial rose-d"><span class="who">CARLUZ</span>O quÃª.</div>
    `,
    choices: [
      { text: 'â†’ O caos se instala â€” quem sai da sala primeiro?', next: 'caos_cozinha', cls: 'danger' },
      { text: 'â†’ A Ellie tenta mediar', next: 'ellie_media_confronto' },
    ],
    switchable: ['Carluz','Eros','Mary','Stephany','Ellie','Mel'],
  },

  ellie_media_confronto: {
    pov: 'Ellie',
    loc: 'Cozinha',
    narr: `
      <p class="narr"><span class="nEllie">Ellie</span> se coloca literalmente entre as pessoas.</p>
      <div class="dial teal-d"><span class="who">ELLIE</span>Para. Tudo para.</div>
      <p class="narr">Quando a Ellie usa esse tom, todo mundo para. Sempre foi assim.</p>
      <div class="dial teal-d"><span class="who">ELLIE</span>VocÃªs podem se machucar com raiva ou podem conversar como adultos. Mas machucar de vez nÃ£o tem volta.</div>
      <p class="narr">SilÃªncio. EntÃ£o a <span class="nCarluz">Carluz</span> olha pro <span class="nEros">Eros</span>:</p>
      <div class="dial rose-d"><span class="who">CARLUZ</span>Vai lÃ¡. Explica.</div>
    `,
    choices: [
      { text: 'â†’ [Como Eros] Explicar tudo Ã  Carluz', next: 'eros_explica_carluz' },
      { text: 'â†’ [Como Carluz] Ouvir o que ele tem a dizer', next: 'carluz_ouve_eros' },
    ],
    switchable: ['Ellie','Eros','Carluz','Stephany'],
  },

  eros_explica_carluz: {
    pov: 'Eros',
    loc: 'Quarto do casal â€” sozinhos',
    narr: `
      <p class="narr">O <span class="nEros">Eros</span> e a <span class="nCarluz">Carluz</span> saÃ­ram da cozinha. EstÃ£o no quarto. A porta fechada.</p>
      <div class="dial teal-d"><span class="who">EROS</span>NÃ£o aconteceu nada, Carluz. Juro.</div>
      <div class="dial rose-d"><span class="who">CARLUZ</span>Mas vocÃª queria que acontecesse?</div>
      <p class="narr">A pausa do <span class="nEros">Eros</span> Ã© um segundo longo demais.</p>
      <div class="dial teal-d"><span class="who">EROS</span>Eu estava com a cabeÃ§a em outro lugar. NÃ£o foi sobre ela. Foi sobre a gente â€” sobre o quanto a gente tava distante.</div>
      <div class="dial rose-d"><span class="who">CARLUZ</span>EntÃ£o vem falar comigo. NÃ£o vai pra varanda com ela.</div>
    `,
    choices: [
      { text: 'â†’ "VocÃª tem razÃ£o. Completamente." Ir em direÃ§Ã£o a ela.', next: 'ending_eros_carluz_reconciliacao', flag: {eros_carluz_reconcilia: true} },
      { text: 'â†’ "Eu tava com medo de te perder e fiz exatamente o que podia me fazer perder vocÃª."', next: 'eros_carluz_longo_caminho', flag: {eros_honesto: true} },
      { text: 'â†’ Ficar em silÃªncio. NÃ£o tem palavras certas.', next: 'carluz_sai_do_quarto', cls: 'danger' },
    ],
    switchable: ['Eros','Carluz'],
  },

  // â•â•â• ENDINGS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  ending_mel_ellie: {
    ending: true,
    type: 'good',
    title: 'Jardim de Madrugada',
    text: 'Mel e Ellie ficam no jardim atÃ© o sol nascer. NinguÃ©m sabe ainda. Mas a Mel, pela primeira vez em meses, nÃ£o estÃ¡ esperando o outro sapato cair. Ela simplesmente estÃ¡. E isso Ã© suficiente.',
    flag: 'ğŸ’™ Final: Mel + Ellie â€” O que sempre deveria ter sido',
  },

  ending_eros_carluz_reconciliacao: {
    ending: true,
    type: 'sweet',
    title: 'Dois Anos Valem',
    text: 'Eles ficam naquele quarto por horas. A mansÃ£o continua caÃ³tica lÃ¡ fora â€” Stephany e Mary, Joy e Mel, toda a confusÃ£o humana. Mas dentro daqui Ã© sÃ³ eles dois. Sempre foi.',
    flag: 'ğŸ’š Final: Eros + Carluz â€” O casal que resistiu',
  },

  ending_mel_joy: {
    ending: true,
    type: 'chaos',
    title: 'Cicatrizes Bonitas',
    text: 'Mel escolhe a Joy. Sabe que pode se machucar de novo. Escolhe de olhos abertos. A Ellie vÃª das janelas â€” nÃ£o diz nada. Guarda aquilo que sentiu como se guarda uma mÃºsica que a gente sÃ³ ouve sozinha.',
    flag: 'ğŸ’” Final: Mel + Joy â€” Amor difÃ­cil, mas escolhido',
  },

  ending_caos: {
    ending: true,
    type: 'bad',
    title: 'A MansÃ£o Vazia',
    text: 'NinguÃ©m cede. Todo mundo machuca todo mundo. Uma semana depois a mansÃ£o estÃ¡ vazia. Eles se falam por grupo. Fingem que tudo estÃ¡ bem. Talvez algum dia esteja.',
    flag: 'ğŸ–¤ Final: O caos vence â€” alguns amores nÃ£o sobrevivem ao mesmo teto',
  },

  ending_nova_ordem: {
    ending: true,
    type: 'chaos',
    title: 'Depois da Tempestade',
    text: 'Ste e Mary, Mel sem ninguÃ©m mas em paz, Eros e Carluz reconstruindo. Ellie vai embora por um mÃªs. Quando volta, a mansÃ£o Ã© diferente. Todos sÃ£o diferentes. Talvez melhor. Talvez apenas mudados.',
    flag: 'ğŸŒ¿ Final coletivo â€” Todo mundo quebrado, todo mundo inteiro',
  },

  // Outros nÃ³s intermediÃ¡rios
  mel_joy_confissao: { 
    pov:'Joy', loc:'Quarto da Mel',
    narr:`<p class="narr"><span class="nJoy">Joy</span> fica parada. Engole. E entÃ£o fala de um jeito que <span class="nMel">Mel</span> nunca ouviu â€” sem defesa, sem charme, sem performance.</p><div class="dial lilac-d"><span class="who">JOY</span>Eu sabotei a gente porque eu tinha medo que vocÃª visse o quanto eu precisava de vocÃª. EntÃ£o eu fui embora primeiro. Foi covarde. Foi a pior coisa que eu jÃ¡ fiz.</div><p class="narr">Mel fecha os olhos.</p>`,
    choices:[
      {text:'â†’ "Isso nÃ£o me faz querer te de volta. Mas ajuda."',next:'mel_processa_joy', flag:{mel_entendeu_joy:true}},
      {text:'â†’ "Por que vocÃª nÃ£o disse isso antes?"',next:'mel_joy_raiva'},
      {text:'â†’ NÃ£o dizer nada. Deixar as lÃ¡grimas virem.',next:'mel_joy_choro', cls:'danger'},
    ],
    switchable:['Mel','Joy','Ellie'],
  },

  mel_processa_joy:{
    pov:'Mel', loc:'Quarto da Mel',
    narr:`<p class="narr">A <span class="nJoy">Joy</span> acena com a cabeÃ§a. Vai sair quando <span class="nMel">Mel</span> fala de novo:</p><div class="dial rose-d"><span class="who">MEL</span>Joy. Obrigada por vir.</div><p class="narr">Ã‰ pequeno. Ã‰ enorme.</p>`,
    choices:[
      {text:'â†’ A noite continua', next:'madrugada_mansao'},
      {text:'â†’ Ver o que a Ellie estÃ¡ fazendo agora', next:'ellie_pov_inicio'},
    ],
    switchable:['Mel','Joy','Ellie'],
  },

  jardim_mel_carluz:{
    pov:'Mel', loc:'Jardim',
    narr:`<p class="narr"><span class="nCarluz">Carluz</span> abre espaÃ§o no banco de pedra e passa a garrafa. <span class="nMel">Mel</span> bebe sem perguntar o que Ã©.</p><div class="dial rose-d"><span class="who">CARLUZ</span>EntÃ£o ela apareceu.</div><div class="dial rose-d"><span class="who">MEL</span>Apareceu.</div><div class="dial rose-d"><span class="who">CARLUZ</span>E?</div><div class="dial rose-d"><span class="who">MEL</span>E eu nÃ£o sei.</div><p class="narr">A Carluz coloca o braÃ§o em volta dela. Simples assim.</p>`,
    choices:[
      {text:'â†’ Ficar no jardim. A noite estÃ¡ boa.',next:'madrugada_mansao'},
      {text:'â†’ A Carluz conta sobre Eros e Mary', next:'carluz_conta_mel'},
    ],
    switchable:['Mel','Carluz'],
  },

  carluz_conta_mel:{
    pov:'Carluz', loc:'Jardim',
    narr:`<div class="dial rose-d"><span class="who">CARLUZ</span>Eu vi ele na varanda com a Mary.</div><p class="narr"><span class="nMel">Mel</span> nÃ£o diz nada. Espera.</p><div class="dial rose-d"><span class="who">CARLUZ</span>NÃ£o aconteceu nada. Mas o jeito que eles se afastaram... como se tivessem sido pegos em alguma coisa.</div><div class="dial rose-d"><span class="who">MEL</span>O que vocÃª quer fazer?</div><div class="dial rose-d"><span class="who">CARLUZ</span>Ainda nÃ£o sei. Por isso tÃ´ aqui bebendo.</div>`,
    choices:[
      {text:'â†’ A noite passa. A conversa pode continuar.', next:'dia_seguinte_tensao'},
    ],
    switchable:['Carluz','Mel','Eros'],
  },

  corredor_mel_ellie:{
    pov:'Mel', loc:'Corredor',
    narr:`<p class="narr"><span class="nEllie">Ellie</span> estÃ¡ perto da janela do corredor. Quando vÃª <span class="nMel">Mel</span>, nÃ£o foge nem avanÃ§a â€” apenas fica.</p><div class="dial teal-d"><span class="who">ELLIE</span>TÃ¡ bem?</div><div class="dial rose-d"><span class="who">MEL</span>TÃ´ tentando.</div>`,
    choices:[
      {text:'â†’ "Pode ficar comigo um pouco?"',next:'mel_ellie_corredor_junto', flag:{mel_pediu_ellie:true}},
      {text:'â†’ Descer pra sala',next:'sala_chegada'},
    ],
    switchable:['Mel','Ellie'],
  },

  mel_ellie_corredor_junto:{
    pov:'Mel', loc:'Corredor â€” janela',
    narr:`<p class="narr">Elas ficam olhando pro jardim juntas. <span class="nEllie">Ellie</span> nÃ£o faz perguntas. <span class="nMel">Mel</span> aprecia isso.</p><div class="notif"><span class="notif-icon">ğŸ“±</span><span><b class="nJoy">Joy</b>: <i>"Eu vi vocÃªs duas. NÃ£o to com raiva. SÃ³ quero que vocÃª seja feliz, Mel."</i></span></div>`,
    choices:[
      {text:'â†’ O coraÃ§Ã£o de Mel acelera com aquela mensagem',next:'madrugada_mansao'},
    ],
    switchable:['Mel','Ellie','Joy'],
  },

  sala_chegada_ellie:{
    pov:'Ellie', loc:'Sala principal',
    narr:`<p class="narr">A sala cheira a tensÃ£o embalada em conversa casual. <span class="nEllie">Ellie</span> se posiciona perto da lareira â€” bom ponto de observaÃ§Ã£o.</p><p class="narr">A <span class="nJoy">Joy</span> estÃ¡ olhando pro celular mas o polegar nÃ£o se move. A <span class="nCarluz">Carluz</span> estÃ¡ rindo alto demais â€” sinal de que estÃ¡ ansiosa. O <span class="nEros">Eros</span> estÃ¡ quieto â€” sinal de que estÃ¡ culpado de algo.</p>`,
    choices:[
      {text:'â†’ Sentar com a Stephany', next:'ellie_stephany_segredo'},
      {text:'â†’ Ir atÃ© a Mel quando ela entrar', next:'ellie_sala_pov'},
    ],
    switchable:['Ellie','Mel','Stephany'],
  },

  ellie_abraca_ste:{
    pov:'Ellie', loc:'Quarto da Stephany',
    narr:`<p class="narr"><span class="nEllie">Ellie</span> abraÃ§a a <span class="nSte">Stephany</span> sem dizer mais nada. Ã€s vezes Ã© tudo que tem a dar.</p><div class="dial lilac-d"><span class="who">STEPHANY</span><i>(baixinho)</i> Obrigada.</div>`,
    choices:[
      {text:'â†’ Voltar pro seu quarto',next:'ellie_pov_inicio'},
      {text:'â†’ Ficar mais um pouco', next:'madrugada_mansao'},
    ],
    switchable:['Ellie','Stephany'],
  },

  ellie_mel_revelacao:{
    pov:'Mel', loc:'Corredor',
    narr:`<p class="narr"><span class="nEllie">Ellie</span> finalmente se vira.</p><div class="dial teal-d"><span class="who">ELLIE</span>VocÃª sabe que eu me importo com vocÃª, Mel. Mais do que devia, provavelmente. E Ã© exatamente por isso que eu nÃ£o consigo fingir que ver vocÃª com ela nÃ£o doeu.</div><p class="narr">SilÃªncio. <span class="nMel">Mel</span> nÃ£o estava esperando isso.</p>`,
    choices:[
      {text:'â†’ "Ellie..."', next:'jardim_mel_ellie_noite', flag:{ellie_revelou:true}},
      {text:'â†’ Ficar em silÃªncio â€” nÃ£o sabe o que dizer',next:'madrugada_mansao'},
    ],
    switchable:['Mel','Ellie'],
  },

  mel_ellie_nao_sei:{
    pov:'Mel', loc:'Jardim',
    narr:`<div class="dial rose-d"><span class="who">MEL</span>Honestamente? NÃ£o sei.</div><p class="narr"><span class="nEllie">Ellie</span> acena com a cabeÃ§a.</p><div class="dial teal-d"><span class="who">ELLIE</span>TÃ¡ bem. NÃ£o sei tambÃ©m.</div><p class="narr">Elas ficam mais um tempo no jardim. Sem beijos, sem respostas. SÃ³ companhia.</p>`,
    choices:[
      {text:'â†’ A noite termina â€” o que o amanhÃ£ traz?', next:'dia_seguinte_tensao'},
    ],
    switchable:['Mel','Ellie'],
  },

  mel_nao_pronta:{
    pov:'Mel', loc:'Jardim',
    narr:`<p class="narr"><span class="nEllie">Ellie</span> abre os olhos. Acena.</p><div class="dial teal-d"><span class="who">ELLIE</span>Eu sei. NÃ£o tem pressa.</div><p class="narr">Elas voltam pra mansÃ£o separadas. Mas a distÃ¢ncia entre elas agora tem nome.</p>`,
    choices:[
      {text:'â†’ O que acontece nos prÃ³ximos dias...', next:'dia_seguinte_tensao'},
    ],
    switchable:['Mel','Ellie'],
  },

  mel_joy_expulsa:{
    pov:'Mel', loc:'Quarto da Mel',
    narr:`<div class="dial rose-d"><span class="who">MEL</span>Sai do meu quarto, Joy.</div><p class="narr"><span class="nJoy">Joy</span> para na porta.</p><div class="dial lilac-d"><span class="who">JOY</span>TÃ¡ bem.</div><p class="narr">E sai. Simples assim.</p>`,
    choices:[
      {text:'â†’ Respirar. Ir pra sala.',next:'sala_chegada'},
      {text:'â†’ Ficar. Processar.',next:'madrugada_mansao'},
    ],
    switchable:['Mel','Joy'],
  },

  mel_joy_cozinha:{
    pov:'Mel', loc:'Cozinha â€” madrugada',
    narr:`<p class="narr">A <span class="nJoy">Joy</span> estÃ¡ sentada no balcÃ£o com chÃ¡ quente. Levanta os olhos quando <span class="nMel">Mel</span> entra â€” nÃ£o sorri, sÃ³ olha.</p><div class="dial lilac-d"><span class="who">JOY</span>Sabia que vocÃª ia vir.</div><div class="dial rose-d"><span class="who">MEL</span>NÃ£o deveria ter vindo.</div><div class="dial lilac-d"><span class="who">JOY</span>Provavelmente nÃ£o.</div><p class="narr">Elas ficam em silÃªncio. Mas Ã© um silÃªncio cheio.</p>`,
    choices:[
      {text:'â†’ Sentar do lado dela', next:'mel_fica_com_joy', cls:'danger', flag:{mel_voltou_joy:true}},
      {text:'â†’ Pegar Ã¡gua e ir embora', next:'madrugada_mansao'},
    ],
    switchable:['Mel','Joy'],
  },

  mel_fica_com_joy:{
    pov:'Mel', loc:'Cozinha / Quarto da Joy',
    narr:`<p class="narr">A noite delas tem dois anos de saudade acumulada e um mÃªs de dor nÃ£o resolvida. NÃ£o Ã© simples. NÃ£o Ã© limpo. Ã‰ honesto.</p><p class="narr">De manhÃ£, <span class="nMel">Mel</span> acorda no quarto da Joy olhando pro teto. A <span class="nJoy">Joy</span> ainda dorme. LÃ¡ fora a mansÃ£o jÃ¡ estÃ¡ acordando.</p><p class="narr">Ela ainda nÃ£o sabe o que isso significa. Mas foi escolha dela.</p>`,
    choices:[
      {text:'â†’ [Final] Assumir esse caminho', next:'ending_mel_joy'},
      {text:'â†’ Sair do quarto antes que alguÃ©m veja', next:'dia_seguinte_tensao'},
    ],
    switchable:['Mel','Joy','Ellie'],
  },

  carluz_procura_janela:{
    pov:'Carluz', loc:'Jardim / MansÃ£o',
    narr:`<p class="narr"><span class="nCarluz">Carluz</span> olha pra janela do corredor. JÃ¡ nÃ£o tem ninguÃ©m lÃ¡.</p><p class="narr">Quem era? Ela guarda a pergunta.</p>`,
    choices:[
      {text:'â†’ Continuar com o Eros', next:'carluz_eros_quarto'},
      {text:'â†’ Ir investigar', next:'ellie_janela_jardim'},
    ],
    switchable:['Carluz','Eros','Ellie'],
  },

  carluz_nega:{
    pov:'Carluz', loc:'Jardim',
    narr:`<div class="dial rose-d"><span class="who">CARLUZ</span>NÃ£o Ã© verdade.</div><p class="narr">O <span class="nEros">Eros</span> a olha por um longo tempo.</p><div class="dial teal-d"><span class="who">EROS</span>TÃ¡ bem.</div><p class="narr">Ele nÃ£o acredita. Ela sabe que ele nÃ£o acredita. Os dois sabem.</p>`,
    choices:[
      {text:'â†’ Mudar de assunto. Ir pra dentro.',next:'sala_chegada'},
      {text:'â†’ Admitir de verdade',next:'carluz_eros_briga_real'},
    ],
    switchable:['Carluz','Eros'],
  },

  carluz_eros_briga_real:{
    pov:'Carluz', loc:'Quarto / Jardim',
    narr:`<p class="narr">A conversa que eles precisavam ter chega com calma que assusta.</p><div class="dial rose-d"><span class="who">CARLUZ</span>Tenho medo que vocÃª prefira a quietude. Que eu seja barulhosa demais.</div><div class="dial teal-d"><span class="who">EROS</span>VocÃª Ã© exatamente barulhosa o suficiente pra me acordar quando eu me perco.</div>`,
    choices:[
      {text:'â†’ Esse Ã© o momento',next:'ending_eros_carluz_reconciliacao'},
    ],
    switchable:['Carluz','Eros'],
  },

  carluz_mary_manha:{
    pov:'Carluz', loc:'Jardim â€” manhÃ£ cedo',
    narr:`<p class="narr">A <span class="nMary">Mary</span> estÃ¡ sentada na grama com cafÃ© na mÃ£o, olhando pro nada. Quando vÃª <span class="nCarluz">Carluz</span>, endireita as costas.</p><div class="dial teal-d"><span class="who">MARY</span>Eu vou embora hoje.</div><div class="dial rose-d"><span class="who">CARLUZ</span>Maryâ€”</div><div class="dial teal-d"><span class="who">MARY</span>NÃ£o foi justo da minha parte. Nada disso. Eu vim aqui sem entender o que era esse grupo e fiz bagunÃ§a.</div>`,
    choices:[
      {text:'â†’ "NÃ£o vai embora por isso."', next:'carluz_perdoa_mary', flag:{carluz_perdoou_mary:true}},
      {text:'â†’ Deixar ela ir â€” talvez seja melhor', next:'ending_caos', cls:'danger'},
    ],
    switchable:['Carluz','Mary','Stephany'],
  },

  carluz_perdoa_mary:{
    pov:'Carluz', loc:'Jardim',
    narr:`<p class="narr"><span class="nCarluz">Carluz</span> senta do lado dela na grama.</p><div class="dial rose-d"><span class="who">CARLUZ</span>VocÃª nÃ£o causou nada que jÃ¡ nÃ£o estava lÃ¡. SÃ³ iluminou o que a gente tava com preguiÃ§a de ver.</div><p class="narr">A <span class="nMary">Mary</span> olha pra ela.</p><div class="dial teal-d"><span class="who">MARY</span>E a Stephany?</div><div class="dial rose-d"><span class="who">CARLUZ</span>Isso eu nÃ£o posso resolver por vocÃª.</div>`,
    choices:[
      {text:'â†’ O grande confronto ainda vai acontecer', next:'dia_seguinte_tensao'},
      {text:'â†’ Ver pela perspectiva da Stephany', next:'stephany_ellie_mary_futuro'},
    ],
    switchable:['Carluz','Mary','Stephany'],
  },

  stephany_ellie_mary_futuro:{
    pov:'Stephany', loc:'Varanda â€” manhÃ£',
    narr:`<p class="narr"><span class="nSte">Stephany</span> nunca foi boa em querer coisas. Ã‰ melhor em observar, em servir de Ã¢ncora pra todo mundo.</p><p class="narr">Mas a <span class="nMary">Mary</span> perguntou o que ela queria, nÃ£o o que era certo â€” e pela primeira vez em muito tempo ela nÃ£o soube responder na hora.</p>`,
    choices:[
      {text:'â†’ Ir atÃ© a Mary', next:'mary_stephany_conversa'},
      {text:'â†’ Falar com a Ellie primeiro', next:'ellie_abraca_ste'},
    ],
    switchable:['Stephany','Mary','Ellie'],
  },

  ellie_observa_sala:{
    pov:'Ellie', loc:'Sala',
    narr:`<p class="narr"><span class="nEllie">Ellie</span> observa e cataloga: <span class="nJoy">Joy</span> quer a <span class="nMel">Mel</span> de volta. A <span class="nMel">Mel</span> quer ser querida sem se machucar. A <span class="nCarluz">Carluz</span> estÃ¡ com medo. O <span class="nEros">Eros</span> estÃ¡ culpado. A <span class="nSte">Stephany</span> estÃ¡ apaixonada. A <span class="nMary">Mary</span> estÃ¡ perdida.</p><p class="narr">E Ellie estÃ¡ apaixonada por alguÃ©m que nÃ£o sabe disso ainda.</p>`,
    choices:[
      {text:'â†’ Agir â€” ir atÃ© a Mel', next:'ellie_senta_mel'},
      {text:'â†’ Mais uma noite de observaÃ§Ã£o', next:'madrugada_mansao'},
    ],
    switchable:['Ellie','Mel'],
  },

  ellie_apoia_stephany:{
    pov:'Ellie', loc:'Quarto da Stephany',
    narr:`<p class="narr"><span class="nEllie">Ellie</span> nÃ£o diz nada. SÃ³ ouve. Ã€s vezes Ã© o mÃ¡ximo que vocÃª pode dar pra alguÃ©m.</p><div class="dial lilac-d"><span class="who">STEPHANY</span>VocÃª Ã© a Ãºnica pessoa aqui que nÃ£o julga.</div><div class="dial teal-d"><span class="who">ELLIE</span>Eu tenho meus prÃ³prios problemas nÃ£o resolvidos. Quem sou eu.</div>`,
    choices:[
      {text:'â†’ Voltar ao corredor â€” ver o que estÃ¡ acontecendo na mansÃ£o', next:'ellie_janela_jardim'},
    ],
    switchable:['Ellie','Stephany'],
  },

  mary_rejeitada_ste:{
    pov:'Mary', loc:'Corredor',
    narr:`<p class="narr">A porta fecha. <span class="nMary">Mary</span> fica parada no corredor por um momento. Depois volta pro quarto.</p><p class="narr">TÃ¡ bem. Ela entendeu.</p>`,
    choices:[
      {text:'â†’ Tentar dormir de novo', next:'dia_seguinte_tensao'},
      {text:'â†’ Ir pra varanda â€” precisa de ar', next:'eros_mary_varanda', cls:'danger'},
    ],
    switchable:['Mary','Stephany','Eros'],
  },

  mary_manha_jardim:{
    pov:'Mary', loc:'Jardim â€” amanhecer',
    narr:`<p class="narr">O jardim de manhÃ£ cedo Ã© completamente diferente. <span class="nMary">Mary</span> senta na grama com os pÃ©s descalÃ§os e pensa que gosta daqui. Gosta dessas pessoas complicadas.</p><p class="narr">NÃ£o quer ir embora.</p>`,
    choices:[
      {text:'â†’ A Carluz chega', next:'carluz_mary_manha'},
      {text:'â†’ A Stephany chega', next:'mary_stephany_conversa'},
    ],
    switchable:['Mary','Carluz','Stephany'],
  },

  mary_stephany_momento:{
    pov:'Mary', loc:'Quarto da Stephany',
    narr:`<p class="narr">O momento acontece com o cuidado de quem nÃ£o quer estragar. Com honestidade. Com aquele tipo de medo bom.</p><p class="narr">De manhÃ£, <span class="nSte">Stephany</span> acorda primeiro e fica olhando pro teto com o menor sorriso do mundo.</p>`,
    choices:[
      {text:'â†’ O dia seguinte â€” e o confronto geral', next:'dia_seguinte_tensao'},
      {text:'â†’ [Final] Esse caminho se firma', next:'ending_nova_ordem'},
    ],
    switchable:['Mary','Stephany'],
  },

  eros_recusa_mary:{
    pov:'Eros', loc:'Varanda',
    narr:`<div class="dial teal-d"><span class="who">EROS</span>Mary. Vai pra dentro.</div><p class="narr">Ela para.</p><div class="dial teal-d"><span class="who">MARY</span>Erosâ€”</div><div class="dial teal-d"><span class="who">EROS</span>Eu amo a Carluz. Totalmente. E vocÃª merece alguÃ©m que possa te dar o mesmo.</div><p class="narr">Pausa longa. Depois ela acena com a cabeÃ§a e entra.</p>`,
    choices:[
      {text:'â†’ Voltar pro quarto com a Carluz', next:'carluz_eros_quarto'},
    ],
    switchable:['Eros','Carluz','Mary'],
  },

  eros_volta_carluz:{
    pov:'Eros', loc:'Quarto do casal',
    narr:`<p class="narr"><span class="nEros">Eros</span> volta pro quarto. A <span class="nCarluz">Carluz</span> estÃ¡ de lado, acordada, fingindo nÃ£o estar.</p><p class="narr">Ele deita do lado dela. Coloca a mÃ£o na dela. Ela entrelaÃ§a os dedos.</p><p class="narr">NÃ£o precisa de palavras essa noite.</p>`,
    choices:[
      {text:'â†’ O dia amanhece', next:'dia_seguinte_tensao'},
    ],
    switchable:['Eros','Carluz'],
  },

  eros_carluz_confronto_varanda:{
    pov:'Eros', loc:'Varanda',
    narr:`<div class="dial teal-d"><span class="who">EROS</span>Carluzâ€”</div><div class="dial rose-d"><span class="who">CARLUZ</span><i>(fria)</i> NÃ£o precisa explicar agora.</div><p class="narr">Ela volta pra dentro. <span class="nEros">Eros</span> fica parado. A <span class="nMary">Mary</span> desaparece rÃ¡pido.</p>`,
    choices:[
      {text:'â†’ Correr atrÃ¡s da Carluz', next:'eros_explica_carluz'},
      {text:'â†’ Deixar a noite esfriar', next:'dia_seguinte_tensao'},
    ],
    switchable:['Eros','Carluz'],
  },

  carluz_guarda_magoa:{
    pov:'Carluz', loc:'Corredor â€” voltando pro quarto',
    narr:`<p class="narr"><span class="nCarluz">Carluz</span> sorri pro <span class="nEros">Eros</span> â€” aquele sorriso que ele nÃ£o reconhece porque nunca foi apontado contra ele. A <span class="nMary">Mary</span> murmura boa noite. Carluz responde.</p><p class="narr">Volta pro quarto. Deita. Fica acordada.</p>`,
    choices:[
      {text:'â†’ A mÃ¡goa silenciosa tem prazo de validade â€” amanhÃ£ ela cobra', next:'dia_seguinte_tensao'},
    ],
    switchable:['Carluz','Eros'],
  },

  carluz_explode_varanda:{
    pov:'Carluz', loc:'Varanda',
    narr:`<div class="dial rose-d"><span class="who">CARLUZ</span>Eros, sÃ©rio? Aqui? Com ela?</div><div class="dial teal-d"><span class="who">EROS</span>NÃ£o aconteceu nada, Carluzâ€”</div><div class="dial rose-d"><span class="who">CARLUZ</span>Eu nÃ£o tÃ´ perguntando o que aconteceu. TÃ´ perguntando o que quase aconteceu.</div><p class="narr">A <span class="nMary">Mary</span> vai embora devagar. Os dois nem percebem.</p>`,
    choices:[
      {text:'â†’ A briga real comeÃ§a', next:'eros_explica_carluz'},
    ],
    switchable:['Carluz','Eros'],
  },

  carluz_confronta_mary_suave:{
    pov:'Carluz', loc:'Varanda',
    narr:`<p class="narr"><span class="nCarluz">Carluz</span> olha diretamente pra <span class="nMary">Mary</span> com um sorriso que nÃ£o Ã© frio, mas tem bordas.</p><div class="dial rose-d"><span class="who">CARLUZ</span>Boa noite, Mary.</div><p class="narr">A <span class="nMary">Mary</span> entende o recado. Boa noite. Vai embora. O <span class="nEros">Eros</span> olha pro chÃ£o.</p>`,
    choices:[
      {text:'â†’ Ir com o Eros pro quarto â€” conversar', next:'eros_explica_carluz'},
    ],
    switchable:['Carluz','Eros','Mary'],
  },

  eros_carluz_longo_caminho:{
    pov:'Eros', loc:'Quarto',
    narr:`<p class="narr">A <span class="nCarluz">Carluz</span> para de falar. Olha pra ele por um longo tempo.</p><div class="dial rose-d"><span class="who">CARLUZ</span>VocÃª Ã© idiota.</div><div class="dial teal-d"><span class="who">EROS</span>Eu sei.</div><div class="dial rose-d"><span class="who">CARLUZ</span>Mas vocÃª Ã© meu idiota. EntÃ£o a gente vai resolver isso.</div>`,
    choices:[
      {text:'â†’ Sim. A gente vai.', next:'ending_eros_carluz_reconciliacao'},
    ],
    switchable:['Eros','Carluz'],
  },

  caos_cozinha:{
    pov:'Mel', loc:'Cozinha',
    narr:`<p class="narr">Todo mundo fala ao mesmo tempo. A <span class="nCarluz">Carluz</span> chora de raiva. O <span class="nEros">Eros</span> tenta falar. A <span class="nMary">Mary</span> pede desculpas. A <span class="nSte">Stephany</span> tenta se explicar. A <span class="nEllie">Ellie</span> fica parada.</p><p class="narr">E a <span class="nMel">Mel</span>. No meio de tudo isso. Olha pra <span class="nEllie">Ellie</span>.</p><p class="narr">Ellie olha de volta. E de repente o caos em volta delas some um pouco.</p>`,
    choices:[
      {text:'â†’ Sair do caos com a Ellie', next:'mel_ellie_primeiro_momento', flag:{mel_ellie_no_caos:true}},
      {text:'â†’ Tentar ajudar a mediar tudo isso', next:'ellie_media_confronto'},
      {text:'â†’ [Final] Deixar tudo explodir', next:'ending_caos'},
    ],
    switchable:['Mel','Ellie','Carluz','Eros'],
  },

  joy_vai_ate_ellie_mel:{
    pov:'Joy', loc:'Sala',
    narr:`<p class="narr"><span class="nJoy">Joy</span> traversa a sala. Para na frente do sofÃ¡ onde <span class="nEllie">Ellie</span> e <span class="nMel">Mel</span> estÃ£o juntas.</p><div class="dial lilac-d"><span class="who">JOY</span>Mel. Posso falar com vocÃª?</div><p class="narr">Um segundo de tensÃ£o. A <span class="nEllie">Ellie</span> nÃ£o move um mÃºsculo. A <span class="nMel">Mel</span> olha pra ela, depois pra Joy.</p>`,
    choices:[
      {text:'â†’ Mel vai falar com a Joy', next:'mel_joy_confissao', flag:{mel_escolheu_ouvir_joy:true}},
      {text:'â†’ "Agora nÃ£o Ã© hora, Joy."', next:'joy_recusa_publica', flag:{mel_recusou_joy_pub:true}},
    ],
    switchable:['Mel','Ellie','Joy'],
  },

  joy_recusa_publica:{
    pov:'Joy', loc:'Sala',
    narr:`<p class="narr">A <span class="nJoy">Joy</span> acena com a cabeÃ§a. Volta pro lugar dela. NÃ£o parece magoada â€” parece que entendeu algo.</p><p class="narr">Ela termina o vinho, levanta e sobe as escadas. NinguÃ©m a segue.</p>`,
    choices:[
      {text:'â†’ A noite continua',next:'madrugada_mansao'},
    ],
    switchable:['Mel','Ellie','Joy'],
  },

  sala_mel_carluz_conversa:{
    pov:'Mel', loc:'Sala â€” sofÃ¡',
    narr:`<p class="narr">A <span class="nCarluz">Carluz</span> fala pra cobrir o silÃªncio â€” sobre a mansÃ£o, sobre a semana, sobre tudo menos o que estÃ¡ pesando. <span class="nMel">Mel</span> ouve e aprecia.</p><div class="notif"><span class="notif-icon">ğŸ‘ï¸</span><span>A <b class="nJoy">Joy</b> observa as duas do outro lado da sala com um olhar indecifrÃ¡vel.</span></div>`,
    choices:[
      {text:'â†’ A noite avanÃ§a', next:'madrugada_mansao'},
    ],
    switchable:['Mel','Carluz','Joy'],
  },

  sala_mel_ellie:{
    pov:'Mel', loc:'Sala â€” poltrona lateral',
    narr:`<p class="narr"><span class="nMel">Mel</span> senta do lado da <span class="nEllie">Ellie</span>. Elas compartilham o silÃªncio natural de quem nÃ£o precisa preencher.</p><div class="dial rose-d"><span class="who">MEL</span><i>(bem baixinho)</i> Obrigada por nÃ£o me perguntar nada ainda.</div><div class="dial teal-d"><span class="who">ELLIE</span><i>(bem baixinho)</i> Pergunto depois.</div>`,
    choices:[
      {text:'â†’ A noite avanÃ§a â€” e o jardim chama', next:'jardim_mel_ellie_noite'},
      {text:'â†’ A Joy vem atÃ© elas', next:'joy_vai_ate_ellie_mel'},
    ],
    switchable:['Mel','Ellie','Joy'],
  },

  sala_mel_joy_publica:{
    pov:'Mel', loc:'Sala',
    narr:`<p class="narr"><span class="nMel">Mel</span> cruza a sala. A <span class="nJoy">Joy</span> se endireita.</p><div class="dial rose-d"><span class="who">MEL</span><i>(baixo, mas todo mundo ouve)</i> A gente precisa conversar. De verdade. Mas nÃ£o aqui.</div><div class="dial lilac-d"><span class="who">JOY</span>Quando vocÃª quiser.</div>`,
    choices:[
      {text:'â†’ Agora â€” ir pra um lugar privado', next:'mel_joy_confronto', flag:{mel_iniciou_conversa:true}},
      {text:'â†’ Depois â€” voltar pro sofÃ¡', next:'sala_mel_ellie'},
    ],
    switchable:['Mel','Joy','Ellie'],
  },

  eros_confronto_pov:{
    pov:'Eros', loc:'Cozinha',
    narr:`<p class="narr">O <span class="nEros">Eros</span> olha pro cafÃ© que fez. EstÃ¡ frio. Assim como a atmosfera.</p><p class="narr">A <span class="nCarluz">Carluz</span> disse <i>"precisamos conversar todos"</i> e ele sabe exatamente sobre o que. Sobre a varanda. Sobre a Mary. Sobre o segundo a mais que custou caro.</p>`,
    choices:[
      {text:'â†’ Ser o primeiro a falar', next:'grande_confronto'},
      {text:'â†’ Deixar a Carluz liderar', next:'ellie_media_confronto'},
    ],
    switchable:['Eros','Carluz','Ellie'],
  },

  mary_confronto_pov:{
    pov:'Mary', loc:'Cozinha',
    narr:`<p class="narr">A <span class="nMary">Mary</span> sabe que Ã© sobre ela. Ã‰ sempre sobre ela â€” a nova que chegou e confundiu tudo.</p><p class="narr">Mas ela estÃ¡ cansada de se sentir o problema. Ela nÃ£o Ã© o problema. O problema jÃ¡ estava aqui antes dela chegar.</p>`,
    choices:[
      {text:'â†’ Falar isso em voz alta', next:'grande_confronto', flag:{mary_se_defendeu:true}},
      {text:'â†’ Ficar quieta e deixar explodir', next:'grande_confronto'},
    ],
    switchable:['Mary','Stephany','Carluz'],
  },

  carluz_ouve_eros:{
    pov:'Carluz', loc:'Quarto',
    narr:`<p class="narr"><span class="nCarluz">Carluz</span> cruza os braÃ§os. Espera.</p><p class="narr">E o <span class="nEros">Eros</span> fala. Finalmente fala tudo â€” o medo, a distÃ¢ncia que ele criou sem perceber, o quase que nÃ£o foi nada mas era sinal de algo maior.</p><p class="narr"><span class="nCarluz">Carluz</span> ouve. NÃ£o interrompe.</p>`,
    choices:[
      {text:'â†’ Quando ele termina, o que ela faz?', next:'eros_carluz_longo_caminho'},
      {text:'â†’ "Obrigada por ser honesto. Mas eu preciso de tempo."', next:'carluz_sai_do_quarto', cls:'danger'},
    ],
    switchable:['Carluz','Eros'],
  },

  carluz_sai_do_quarto:{
    pov:'Carluz', loc:'Corredor',
    narr:`<p class="narr"><span class="nCarluz">Carluz</span> sai do quarto sem portada. Sem drama. SÃ³ sai.</p><p class="narr">O <span class="nEros">Eros</span> fica parado. Sabe que correr atrÃ¡s agora nÃ£o Ã© o que ela precisa.</p>`,
    choices:[
      {text:'â†’ [Final] O amor sobrevive, mas muda de forma', next:'ending_nova_ordem'},
      {text:'â†’ O dia passa. Eles se reencontram depois.', next:'dia_seguinte_tensao'},
    ],
    switchable:['Carluz','Eros'],
  },

  mel_joy_raiva:{
    pov:'Mel', loc:'Quarto',
    narr:`<div class="dial rose-d"><span class="who">MEL</span>Por que vocÃª nÃ£o disse isso antes, Joy?</div><div class="dial lilac-d"><span class="who">JOY</span>Porque eu tinha 22 anos e era covarde. Ainda sou, Ã s vezes.</div><p class="narr">A raiva de <span class="nMel">Mel</span> tem duas camadas â€” a de fora e a de baixo. A de baixo quase parece alÃ­vio.</p>`,
    choices:[
      {text:'â†’ "Eu precisava ouvir isso."', next:'mel_processa_joy'},
      {text:'â†’ A raiva ainda Ã© maior', next:'mel_joy_expulsa'},
    ],
    switchable:['Mel','Joy'],
  },

  mel_joy_choro:{
    pov:'Mel', loc:'Quarto',
    narr:`<p class="narr"><span class="nMel">Mel</span> nÃ£o faz nada â€” e Ã© exatamente isso que ela precisa. As lÃ¡grimas vÃªm devagar, sem drama.</p><p class="narr">A <span class="nJoy">Joy</span> senta do lado dela sem tocar. SÃ³ fica.</p>`,
    choices:[
      {text:'â†’ Depois de um tempo â€” a conversa real', next:'mel_joy_confissao'},
      {text:'â†’ Joy toca o ombro dela â€” e ela nÃ£o se afasta', next:'mel_joy_beijo', flag:{mel_vulneravel_joy:true}},
    ],
    switchable:['Mel','Joy'],
  },
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ENGINE FUNCTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function startGame() {
  document.getElementById('title-screen').style.display = 'none';
  document.getElementById('pov-bar').style.display = 'flex';
  document.getElementById('game').style.display = 'block';
  buildPovBar();
  goTo('intro');
}

function buildPovBar() {
  const row = document.getElementById('pov-row');
  row.innerHTML = '';
  Object.keys(CHARS).forEach(name => {
    const btn = document.createElement('button');
    btn.className = 'pov-char';
    btn.id = 'pov-' + name;
    btn.textContent = CHARS[name].emoji + ' ' + name;
    btn.onclick = () => switchPOV(name);
    row.appendChild(btn);
  });
  updatePovBar();
}

function updatePovBar() {
  document.querySelectorAll('.pov-char').forEach(b => b.classList.remove('active'));
  const active = document.getElementById('pov-' + state.pov);
  if (active) active.classList.add('active');
}

function switchPOV(name) {
  // Find an appropriate scene for this character
  const povEntry = Object.entries(SCENES).find(([id, s]) => 
    s.pov === name && !s.ending && !state.history.includes(id)
  ) || Object.entries(SCENES).find(([id, s]) => s.pov === name && !s.ending);
  
  if (povEntry) {
    state.pov = name;
    updatePovBar();
    goTo(povEntry[0]);
  }
}

function goTo(sceneId, choiceFlag) {
  if (choiceFlag) {
    Object.assign(state.flags, choiceFlag);
  }
  
  const scene = SCENES[sceneId];
  if (!scene) return;
  
  if (scene.ending) {
    showEnding(scene);
    return;
  }
  
  state.history.push(sceneId);
  state.pov = scene.pov;
  updatePovBar();
  renderScene(scene);
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function renderScene(scene) {
  const game = document.getElementById('game');
  
  const colorMap = { Mel:'rose', Ellie:'teal', Carluz:'gold', Eros:'gold', Stephany:'lilac', Mary:'teal', Joy:'rose' };
  const povColor = colorMap[scene.pov] || 'gold';
  
  let html = `
    <div class="scene-bar">
      <span class="tag-pov ${povColor}">${CHARS[scene.pov].emoji} ${scene.pov}</span>
      <span class="tag-loc">ğŸ“ ${scene.loc}</span>
    </div>
    ${scene.narr}
    <div class="choices">
  `;
  
  scene.choices.forEach(c => {
    const cls = c.cls ? ` ${c.cls}` : '';
    const flagStr = c.flag ? JSON.stringify(c.flag) : '{}';
    html += `<button class="choice-btn${cls}" onclick="goTo('${c.next}', ${flagStr})">${c.text}</button>`;
  });
  
  html += `</div>`;
  
  // POV switch hint
  if (scene.switchable && scene.switchable.length > 1) {
    const others = scene.switchable.filter(n => n !== scene.pov);
    html += `<div class="pov-hint">â–² Troque a perspectiva para: ${others.join(', ')}</div>`;
  }
  
  game.innerHTML = html;
}

function showEnding(scene) {
  document.getElementById('pov-bar').style.display = 'none';
  document.getElementById('game').style.display = 'none';
  
  const es = document.getElementById('ending-screen');
  es.style.display = 'block';
  
  document.getElementById('ending-label').textContent = 'â€” FIM â€”';
  document.getElementById('ending-title').className = `ending-title ${scene.type}`;
  document.getElementById('ending-title').textContent = scene.title;
  document.getElementById('ending-text').textContent = scene.text;
  document.getElementById('ending-flag').textContent = scene.flag || '';
  
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function restart() {
  state = { pov: 'Mel', flags: {}, history: [] };
  document.getElementById('ending-screen').style.display = 'none';
  document.getElementById('title-screen').style.display = 'flex';
}
</script>
</body>
</html>
